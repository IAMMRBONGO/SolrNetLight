<!DOCTYPE html>
<html>
<head>
    <title>SolrNetLight</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:300,600,700" rel="stylesheet" />
    <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
    <script src="../../js/jquery.min.js"></script>
    <script src="../../js/config.js"></script>
    <script src="../../js/skel.min.js"></script>
    <noscript>
        <link rel="stylesheet" href="../../css/skel-noscript.css" />
        <link rel="stylesheet" href="../../css/style.css" />
        <link rel="stylesheet" href="../../css/style-desktop.css" />
    </noscript>
    <!--[if lte IE 9]><link rel="stylesheet" href="css/ie9.css" /><![endif]-->
    <!--[if lte IE 8]><script src="js/html5shiv.js"></script><link rel="stylesheet" href="css/ie8.css" /><![endif]-->
    <!--[if lte IE 7]><link rel="stylesheet" href="css/ie7.css" /><![endif]-->

</head>
<body>

    <!-- Nav -->
    <nav id="nav">
        <ul class="container">
            <li><a href="#solrindex">SolR Index</a></li>
            <li><a href="#sampledata">Sample Data</a></li>
            <li><a href="#consoleapp">Console App Project</a></li>
        </ul>
    </nav>

    <!-- SolR Index -->

    <div class="wrapper wrapper-style2" style="padding:100px 0 0 0">
        <article id="solrindex">
            <header>
                <h2>Do Simple Query in SolR Index</h2>
                <span>SolrNetLight allows you to make queries with all your devices on your SolR server instance in very simple way.</span>
            </header>
            <div class="container">
                <div class="12u" align="left">
                    <h3>Solr Index</h3>
                    Create a new solr index called "customer"  <br />
                    Update its "schema.xml" file with the following properties :

<pre class="prettyprint">
<code class="language-xml">
&lt;!-- id--> 
&lt;field name="id" type="long" indexed="true" stored="true" required="true" multiValued="false" />
&lt;!-- firstName--> 
&lt;field name="firstName" type="string" indexed="true" stored="true"/>
&lt;!-- lastName --> 
&lt;field name="lastName" type="string" indexed="true" stored="true"/> 
&lt;!-- roles --> 
&lt;field name="roles" type="string" indexed="true" stored="true" multiValued="true"/> 
&lt;!-- phone_* --> 
&lt;dynamicField name="phone_*" type="string" indexed="true" stored="true" />
	 
</code>
</pre>
                    <br />
                    Restart your Solr instance to and make sure everything works.
                </div>
            </div>
        </article>
    </div>
    <!--Sample Data-->
    <div class="wrapper wrapper-style2" style="padding:10px 0 0 0;">
        <article id="sampledata">
            <header></header>
            <div class="container">
                <div class="12u" align="left">
                    <h3>Sample data</h3>

<pre class="prettyprint">
<code class="language-json">
{
  "responseHeader": {
    "status": 0,
    "QTime": 0,
    "params": {
      "spellcheck": "true",
      "indent": "true",
      "q": "*:*",
      "_": "1404822864286",
      "wt": "json"
    }
  },
  "response": {
    "numFound": 4,
    "start": 0,
    "docs": [
      {
        "id": 1104,
        "lastName": "Lamande",
        "firstName": "Dorian",
        "roles": [
          ".NET"
        ],
        "phone_mobile": "0123456789",
        "phone_home": "0123456789",
        "_version_": 1473063496451096600
      },
      {
        "id": 1105,
        "lastName": "Fabrizi",
        "firstName": "Guillaume",
        "roles": [
          ".NET"
        ],
        "phone_mobile": "0123456789",
        "phone_home": "0123456789",
        "_version_": 1473063497375940600
      }
   ]
  }
}
</code>
</pre>
                </div>
            </div>
        </article>
    </div>

    <div class="wrapper wrapper-style2" style="padding:10px 0 0 0;">
        <article id="consoleapp">
            <header></header>
            <div class="container">
                <div class="12u" align="left">

                    <h3>Console App project</h3>

                    Create a new Console app project

                    Add  a new class "CustomerIndex" similar to below :

<pre class="prettyprint">
<code class="language-cs">
using Newtonsoft.Json;
using SolrNetLight.Attributes;
using SolrNetLight.Impl.FieldSerializers;
using System;
using System.Collections.Generic;
using System.Runtime.Serialization;
namespace SolrNetLight.ConsoleApp
{
    [DataContract]
    public class CustomerIndex
    {
        public const string INDEX_NAME = "customer";
        [SolrUniqueKey("id")]
        [DataMember(Name="id")]
        public long Id { get; set; }
        [DataMember(Name="lastName")]
        public string LastName { get; set; }
        [DataMember(Name="firstName")]
        public string FirstName { get; set; }
        [DataMember(Name = "roles")]
        public List<string> Roles { get; set; }
        [DataMember(Name = "phone_")]
        [JsonConverter(typeof(DictionaryFieldJsonConverter))]
        public IDictionary<string,string> PhoneNumber { get; set; }
        public CustomerIndex()
        {
            PhoneNumber = new Dictionary<string, string>();
	     Roles = new List<string>();
        }
    }
}
</code>
</pre>

                    <br />

                    Link your class properties with SolrIndex schema's properties with DataMember attribute.

                    Create a "CustomerService" class in order to create our Solr query methods.

<pre class="prettyprint">
                    <code class="language-cs">
    public class CustomerService
    {
        private ISolrOperations<customerindex> _customerSolRInstance;
        public CustomerService()
        {
            _customerSolRInstance = ServiceLocator.Current.GetInstance<isolroperations<customerindex>>();
        }
        /// <summary>
        /// Get Customer by firstName
        /// </summary>
        /// <param name="name"></param>
        /// <returns></returns>
        public async Task<customerindex> GetCustomerByName(string firstName)
        {
            CustomerIndex result = null;
            try
            {
                var results = await _customerSolRInstance.Query(new SolrQueryByField("firstName", firstName));
                if (results != null && results.Count > 0)
                {
                    result = results[0];
                }
            }
            catch (SolrNetException ex)
            {
                
            }
            return result;
        }
        /// <summary>
        /// Add new customers
        /// </summary>
        public async Task AddCustomers()
        {
            try
            {
                var dlamande = new CustomerIndex
                {
                    Id = 1000,
                    FirstName = "Dorian",
                    LastName = "Lamande",
                    Roles = new List<string> { ".NET" },
                    PhoneNumber = { new KeyValuePair<string, string>("mobile", "0123456789"), new KeyValuePair<string, string>("home", "0123456789") }
                };
                var gfabrizi = new CustomerIndex
                {
                    Id = 1001,
                    FirstName = "Guillaume",
                    LastName = "Fabrizi",
                    Roles = new List<string> { ".NET" },
                    PhoneNumber = { new KeyValuePair<string, string>("mobile", "0123456789"), new KeyValuePair<string, string>("home", "0123456789") }
                };
                await _customerSolRInstance.Add(dlamande);
                await _customerSolRInstance.Add(gfabrizi);
              
                await _customerSolRInstance.Commit();
            }
            catch (Exception ex)
            {
            }
        }
    }
 </code>
</pre>

                    <br />

                    In Program.cs,  you can add these following lines and try to get data

<pre class="prettyprint">
<code class="language-cs">
               class Program
    {
        private static CustomerService _customerService;
        static void Main(string[] args)
        {
            //Initialize Solr Customer Index with current Solr local instance
            Startup.Init<customerindex>(String.Format("{0}{1}", "http://localhost:8983/solr/", CustomerIndex.INDEX_NAME));
            //Instanciate customer service
            _customerService = new CustomerService();
            DoRequest().Wait();
            Console.ReadLine();
        }
        private static async Task DoRequest()
        {
            //Add query
            await _customerService.AddCustomers();
            //Make simple queries
            CustomerIndex dlamande = await _customerService.GetCustomerByName("Dorian");
            CustomerIndex gfabrizi = await _customerService.GetCustomerByName("Guillaume");
            //Display results
            Console.WriteLine(String.Concat(dlamande.FirstName, dlamande.LastName));
            Console.WriteLine(String.Concat(gfabrizi.FirstName, gfabrizi.LastName));
        }
    }
    </code>
</pre>
                    <br />
                    Result :
                    <image src="images/Console-App.png" />

                </div>


            </div>
        </article>
    </div>
</body>
</html>